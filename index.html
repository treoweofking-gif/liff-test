<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</title>
</head>
<body>
  <h1>ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</h1>
  <div id="message" style="white-space: pre-wrap;">èµ·å‹•ä¸­...</div>

  <ul id="menu" style="display:none;">
    <li>ğŸ“„ ä¼‘æš‡ç”³è«‹</li>
    <li>â± æ®‹æ¥­ç”³è«‹</li>
    <li>ğŸ  ä½æ‰€å¤‰æ›´å±Š</li>
  </ul>

  <!-- â˜…ã“ã‚ŒãŒç„¡ã„ã¨ liff ãŒå­˜åœ¨ã—ã¾ã›ã‚“ -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <!-- â˜…sdk.js ã®ã€Œå¾Œã€ã«ç½®ã -->
  <script>
    async function init() {
      const el = document.getElementById("message");
      const setMsg = (t) => { el.textContent = t; };
      const addMsg = (t) => { el.textContent += "\n" + t; };

      try {
        if (typeof liff === "undefined") {
          msg("ã‚¨ãƒ©ãƒ¼: LIFF SDK ãŒèª­ã¿è¾¼ã‚ã¦ã„ã¾ã›ã‚“ï¼ˆliff ãŒæœªå®šç¾©ï¼‰");
          return;
        }

        msg("1) LIFF åˆæœŸåŒ–ä¸­...");
        await liff.init({ liffId: "2008866562-UCmyNOOE" });

        msg("2) isLoggedIn=" + liff.isLoggedIn());
        if (!liff.isLoggedIn()) {
          msg("3) æœªãƒ­ã‚°ã‚¤ãƒ³â†’loginã¸é·ç§»ã—ã¾ã™");
          liff.login();
          return;
        }

        msg("4) getProfileä¸­...");
        const profile = await liff.getProfile();
        msg("5) userId=" + profile.userId);

        msg("6) /api/me å‘¼ã³å‡ºã—ä¸­...");
        const res = await fetch(
          "https://liff-api.onrender.com/api/me?line_user_id=" + profile.userId
        );
        const data = await res.json();

        setMsg("7) exists=" + data.exists);
        addMsg("API raw:\n" + JSON.stringify(data, null, 2));

        if (data.exists === true) {
          document.getElementById("menu").style.display = "block";
          addMsg("8) èªè¨¼OKï¼šç”³è«‹æ›¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤º");
        } else {
          addMsg("8) æœªç™»éŒ²ï¼šç®¡ç†éƒ¨ã¸é€£çµ¡ã—ã¦ãã ã•ã„");
        }

      } catch (e) {
        msg("ã‚¨ãƒ©ãƒ¼: " + (e && e.message ? e.message : e));
      }
    }

    init();
  </script>
</body>
</html>
