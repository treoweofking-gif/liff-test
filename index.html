<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</title>
</head>

<body>
  <h1 id="title">ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</h1>
  <div id="message">åˆæœŸåŒ–ä¸­...</div>

  <ul id="menu" style="display:none;">
    <li>ğŸ“„ ä¼‘æš‡ç”³è«‹</li>
    <li>â± æ®‹æ¥­ç”³è«‹</li>
    <li>ğŸ  ä½æ‰€å¤‰æ›´å±Š</li>
  </ul>

<script>
  async function init() {
    const msg = (t) => { document.getElementById("message").innerText = t; };

    try {
      msg("1) LIFF åˆæœŸåŒ–ä¸­...");
      await liff.init({ liffId: "2008866562-UCmyNOOE" });

      msg("2) isLoggedIn=" + liff.isLoggedIn());

      if (!liff.isLoggedIn()) {
        msg("3) æœªãƒ­ã‚°ã‚¤ãƒ³â†’loginã¸é·ç§»ã—ã¾ã™");
        liff.login(); // ã“ã“ã§ç”»é¢ãŒé·ç§»ã™ã‚‹ã®ãŒæ­£å¸¸
        return;
      }

      msg("4) getProfileä¸­...");
      const profile = await liff.getProfile();
      msg("5) userId=" + profile.userId);

      msg("6) /api/me å‘¼ã³å‡ºã—ä¸­...");
      const res = await fetch(
        "https://liff-api.onrender.com/api/me?line_user_id=" + profile.userId
      );
      const data = await res.json();

      msg("7) exists=" + data.exists);

      if (data.exists === true) {
        document.getElementById("menu").style.display = "block";
      }
    } catch (e) {
      document.getElementById("message").innerText = "ã‚¨ãƒ©ãƒ¼: " + e.message;
    }
  }

  init();
</script>
</body>
</html>
