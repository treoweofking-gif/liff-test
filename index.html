<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</title>
</head>

<body>
  <h1 id="title">ç¤¾å†…ãƒãƒ¼ã‚¿ãƒ«</h1>
  <div id="message">åˆæœŸåŒ–ä¸­...</div>

  <ul id="menu" style="display:none;">
    <li>ğŸ“„ ä¼‘æš‡ç”³è«‹</li>
    <li>â± æ®‹æ¥­ç”³è«‹</li>
    <li>ğŸ  ä½æ‰€å¤‰æ›´å±Š</li>
  </ul>

  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

  <script>
    async function init() {
      try {
        document.getElementById("message").innerText = "LIFF åˆæœŸåŒ–ä¸­";

        await liff.init({ liffId: "2008866562-UCmyNOOE" });

        if (!liff.isLoggedIn()) {
          document.getElementById("message").innerText = "LINEãƒ­ã‚°ã‚¤ãƒ³ã¸é·ç§»";
          liff.login();
          return;
        }

        document.getElementById("message").innerText = "ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ä¸­";

        const profile = await liff.getProfile();
        const userId = profile.userId;

        document.getElementById("message").innerText =
          "èªè¨¼ç¢ºèªä¸­: " + userId;

        const res = await fetch(
          "https://liff-api.onrender.com/api/me?line_user_id=" + userId
        );

        const data = await res.json();

        if (data.exists === true) {
          document.getElementById("message").innerText =
            "èªè¨¼OKï¼šç”³è«‹æ›¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã—ã¾ã™";
          document.getElementById("menu").style.display = "block";
        } else {
          document.getElementById("message").innerText =
            "ç¤¾å“¡ç™»éŒ²ãŒç¢ºèªã§ãã¾ã›ã‚“ã€‚ç®¡ç†éƒ¨ã¸é€£çµ¡ã—ã¦ãã ã•ã„ã€‚";
        }

      } catch (e) {
        document.getElementById("message").innerText =
          "ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: " + e.message;
      }
    }

    init();
  </script>
</body>
</html>
